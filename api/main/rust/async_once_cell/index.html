<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A collection of lazy initialized values that are created by `Future`s."><title>async_once_cell - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-63a85fc7cf22dee2.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="async_once_cell" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0-nightly (696aaad58 2023-04-09)" data-search-js="search-bc5a112813b5d712.js" data-settings-js="settings-298e1ea74db45b39.js" data-settings-css="settings-0bcba95ff279c1db.css" data-theme-light-css="light-db279b6232be9c13.css" data-theme-dark-css="dark-cf923f49f397b216.css" data-theme-ayu-css="ayu-be46fdc453a55015.css" ></div><script src="../static.files/storage-62ce34ea385b278a.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-1159a395118aa44e.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../static.files/light-db279b6232be9c13.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../static.files/dark-cf923f49f397b216.css"><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../async_once_cell/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../async_once_cell/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate async_once_cell</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.5.3</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#structs">Structs</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">async_once_cell</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/async_once_cell/lib.rs.html#1-1429">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A collection of lazy initialized values that are created by <code>Future</code>s.</p>
<p><a href="struct.OnceCell.html" title="struct async_once_cell::OnceCell">OnceCell</a>’s API is similar to the <a href="https://crates.io/crates/once_cell"><code>once_cell</code></a> crate,
<a href="https://doc.rust-lang.org/nightly/core/cell/once/struct.OnceCell.html" title="struct core::cell::once::OnceCell"><code>std::cell::OnceCell</code></a>, or <a href="https://doc.rust-lang.org/nightly/std/sync/once_lock/struct.OnceLock.html" title="struct std::sync::once_lock::OnceLock"><code>std::sync::OnceLock</code></a>.  It provides an async version of a cell
that can only be initialized once, permitting tasks to wait on the initialization if it is
already running instead of racing multiple initialization tasks.</p>
<p>Unlike threads, tasks can be cancelled at any point where they block.  <a href="struct.OnceCell.html" title="struct async_once_cell::OnceCell">OnceCell</a> deals with
this by allowing another initializer to run if the task currently initializing the cell is
dropped.  This also allows for fallible initialization using <a href="struct.OnceCell.html#method.get_or_try_init" title="method async_once_cell::OnceCell::get_or_try_init">OnceCell::get_or_try_init</a> and
for the initializing <code>Future</code> to contain borrows or use references to thread-local data.</p>
<p><a href="struct.Lazy.html" title="struct async_once_cell::Lazy">Lazy</a> takes the opposite approach: it wraps a single <code>Future</code> which is cooperatively run to
completion by any polling task.  This requires that the initialization function be independent
of the calling context, but will never restart an initializing function just because the
surrounding task was cancelled.  Using a trait object (<code>Pin&lt;Box&lt;dyn Future&gt;&gt;</code>) for the future
may simplify using this type in data structures.</p>
<h2 id="overhead"><a href="#overhead">Overhead</a></h2>
<p>Both cells use two <code>usize</code>s to store state and do not retain any allocations after
initialization is complete.  Allocations are only required if there is contention.</p>
<p>Accessing an already-initialized cell is as cheap as possible: only one atomic load with
Acquire ordering.</p>
<h2 id="features"><a href="#features">Features</a></h2><h3 id="the-critical-section-feature"><a href="#the-critical-section-feature">The <code>critical-section</code> feature</a></h3>
<p>If this feature is enabled, the <a href="https://crates.io/crates/critical-section"><code>critical-section</code></a>
crate is used instead of an <code>std</code> mutex.  You must depend on that crate and select a locking
implementation; see <a href="https://docs.rs/critical-section/">its documentation</a> for details.</p>
<h3 id="the-std-feature"><a href="#the-std-feature">The <code>std</code> feature</a></h3>
<p>This is currently a no-op, but might in the future be used to expose APIs that depends on
types only in <code>std</code>.  It does <em>not</em> control the locking implementation.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Lazy.html" title="struct async_once_cell::Lazy">Lazy</a></div><div class="desc docblock-short">A value which is computed on demand by running a future.</div></li><li><div class="item-name"><a class="struct" href="struct.LazyFuturePin.html" title="struct async_once_cell::LazyFuturePin">LazyFuturePin</a></div><div class="desc docblock-short">A helper struct for <a href="struct.Lazy.html" title="struct async_once_cell::Lazy">Lazy</a>’s <a href="https://doc.rust-lang.org/nightly/core/future/into_future/trait.IntoFuture.html" title="trait core::future::into_future::IntoFuture">IntoFuture</a></div></li><li><div class="item-name"><a class="struct" href="struct.LazyFutureUnpin.html" title="struct async_once_cell::LazyFutureUnpin">LazyFutureUnpin</a></div><div class="desc docblock-short">A helper struct for <a href="struct.Lazy.html" title="struct async_once_cell::Lazy">Lazy</a>’s <a href="https://doc.rust-lang.org/nightly/core/future/into_future/trait.IntoFuture.html" title="trait core::future::into_future::IntoFuture">IntoFuture</a></div></li><li><div class="item-name"><a class="struct" href="struct.OnceCell.html" title="struct async_once_cell::OnceCell">OnceCell</a></div><div class="desc docblock-short">A cell which can be written to only once.</div></li></ul></section></div></main></body></html>